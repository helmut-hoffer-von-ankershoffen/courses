!function(){"use strict";var a=function(a){var b=this;this.url=m.prop(a.url),this.plugins=m.prop(a.plugins),this.slug=m.prop(a.slug||Object.keys(a.plugins)[0]),this.n=m.prop(a.n||10),this.pluginName=function(){for(var a=Object.keys(b.plugins()),c=0;c<a.length;c++)if(a[c]===b.slug())return b.plugins()[a[c]];return"Unknown"}},b={};b.vm=function(){var b={};return b.config=new a(wpp.config),b.init=function(){b.running=m.prop(!1),b.results=m.prop([]),b.finished=m.prop(!1),b.percentageDifference=m.prop(0),b.sums=m.prop([0,0,0,0]),b.averages=m.prop([0,0,0,0])},b}(),b.addResult=function(a){b.vm.results().push(a);for(var c=b.vm.sums(),d=b.vm.averages(),e=0;e<a.length;e++)c[e]+=a[e],d[e]=(c[e]/b.vm.results().length).toPrecision(3);b.vm.sums(c),b.vm.averages(d);var f=(c[1]/c[0]+c[3]/c[2])/2*100-100;b.vm.percentageDifference(f>0?f:0),m.redraw()},b.getResult=function(){if(b.vm.finished(b.vm.results().length>=b.vm.config.n()),b.vm.running()&&!b.vm.finished()){var a={method:"GET",url:wpp.ajaxurl,data:{action:"plugin_profiler",url:b.vm.config.url(),slug:b.vm.config.slug()}};m.request(a).then(function(a){b.addResult(a),b.getResult()})}},b.toggle=function(){b.vm.running()?b.stop():b.start(),m.redraw()},b.start=function(){b.vm.running(!0),b.getResult()},b.stop=function(){b.vm.running(!1)},b.reset=function(){b.vm.init()},b.updateChart=function(a,c,d){var e=b.vm,f=e.averages();if(c){for(var g=0;g<d.chart.datasets[0].bars.length;g++)d.chart.datasets[0].bars[g].value=f[g];d.chart.update()}else{var h={labels:["No plugins","Only "+e.config.pluginName(),"All but "+e.config.pluginName(),"All plugins"],datasets:[{label:"Load times",strokeColor:"rgba(6, 211, 92,1)",fillColor:"rgba(6, 211, 92,1)",data:f}]};d.chart=new Chart(a.getContext("2d")).Bar(h,{})}},b.doesResultDeviate=function(a,c){var d=b.vm.averages();return a[c]>1.15*d[c]||a[c]<.85*d[c]},b.controller=function(){b.vm.init()},b.view=function(){var a=b.vm,c=a.config;if(!b.vm.running()&&0===a.results().length)return[m("table.form-table",[m("tr",[m("th","Select the plugin to profile."),m("td",[m("select",{onchange:m.withAttr("value",b.vm.config.slug)},Object.keys(b.vm.config.plugins()).map(function(c){return m("option",{value:c,selected:a.config.slug()==c},b.vm.config.plugins()[c])}))])]),m("tr",[m("th","Enter the URL to profile"),m("td",[m("input",{type:"text","class":"regular-text",value:b.vm.config.url(),onchange:m.withAttr("value",b.vm.config.url)})])]),m("tr",[m("th","Number of requests"),m("td",[m("input",{type:"number",min:0,step:1,value:b.vm.config.n(),onchange:m.withAttr("value",b.vm.config.n)})])])]),m("p",[m("input",{type:"submit","class":"button button-primary",value:"Run Profile",onclick:b.start})])];a.results();return m("div.results",[m("p",[a.finished()?"":m("input",{type:"button","class":"button",onclick:b.toggle,value:a.running()?"Stop":"Continue"})," ",a.running()&&!a.finished()?"":m("input",{type:"button","class":"button button-danger",onclick:b.reset,value:"Reset"})]),m("p",[m("strong",a.finished()?"Done!":"Running... "+a.results().length+"/"+c.n())]),m("p",m.trust("On average, "+c.pluginName()+" added <strong>"+a.percentageDifference().toPrecision(3)+"%</strong> to each request.")),m("canvas",{width:600,height:400,config:b.updateChart}),m("h3","Profile Details"),m("table.data",[m("thead",[m("tr",[m("th","#"),m("th","No plugins"),m("th","Only "+c.pluginName()),m("th","All but "+c.pluginName()),m("th","All plugins")])]),m("tbody",[a.results().map(function(a,c){return m("tr",[m("td",c+1),a.map(function(c,d){var e=[];return 0==c?e.push("error"):b.doesResultDeviate(a,d)&&e.push("deviates"),m("td",{"class":e.join(",")},c+"s")})])})])])])},m.module(document.getElementById("profiler-mount"),b)}();